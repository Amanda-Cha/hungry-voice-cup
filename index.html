<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬2å±†çª®å˜¶ç›ƒæ­Œç‹æ­Œåçˆ­éœ¸æˆ°</title>
    <style>
        :root { --primary: #ff4757; --accent: #ff9f43; --bg: #1e2124; --card: #36393e; --btn-light: #57606f; }
        body { font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; background: var(--bg); color: #fff; margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 500px; text-align: center; }
        
        h1 { color: var(--accent); font-size: 1.6rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); margin-bottom: 20px; line-height: 1.4; text-align: center; }
        
        .rules { background: #2f3136; padding: 12px; border-radius: 10px; font-size: 0.85rem; text-align: left; margin-bottom: 20px; border-left: 5px solid var(--accent); line-height: 1.6; }

        /* é¸æ‰‹é¸æ“‡å€ - èª¿äº®åº•è‰² */
        .player-selector { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 20px; }
        .player-btn { background: var(--btn-light); border: 2px solid #8395a7; color: white; padding: 12px 2px; border-radius: 12px; cursor: pointer; position: relative; font-weight: bold; font-size: 1rem; transition: all 0.2s; }
        .player-btn.active { border-color: #fff; background: var(--accent); color: #000; box-shadow: 0 0 15px rgba(255,159,67,0.6); transform: scale(1.05); }
        .player-btn:disabled { opacity: 0.2; cursor: not-allowed; background: #2f3542; border-color: transparent; }
        .count-badge { font-size: 0.7rem; display: block; margin-top: 4px; opacity: 0.9; }

        /* è©•åˆ†å€ & æ˜Ÿæ˜Ÿç¸®æ”¾ä¿®æ­£ */
        .score-card { background: var(--card); border-radius: 15px; padding: 15px; text-align: center; margin-bottom: 20px; border: 1px solid #4f545c; }
        .stars { display: flex; justify-content: center; align-items: center; flex-wrap: nowrap; gap: 4px; margin: 15px 0; }
        .star { cursor: pointer; color: #4f545c; transition: 0.2s; text-shadow: 0 0 2px #000; font-size: 8.5vw; } /* éš¨è¢å¹•å¯¬åº¦ç¸®æ”¾ */
        
        @media (min-width: 500px) { .star { font-size: 40px; } }

        .star.selected { color: var(--accent); text-shadow: 0 0 10px rgba(255,159,67,0.8); }
        .submit-btn { width: 100%; padding: 16px; background: #2ed573; border: none; border-radius: 10px; color: white; font-weight: bold; font-size: 1.2rem; cursor: pointer; margin-top: 10px; box-shadow: 0 4px 0 #26af5a; }

        /* è¡¨æ ¼æ¨£å¼ */
        table { width: 100%; background: var(--card); border-radius: 10px; border-collapse: collapse; overflow: hidden; margin-top: 10px; font-size: 0.95rem; }
        th, td { padding: 12px 8px; text-align: center; border-bottom: 1px solid #2f3136; }
        th { background: #2f3136; color: var(--accent); }
        .rank-1 { background: rgba(255, 165, 2, 0.15); color: #ffd700; font-weight: bold; }

        /* å¾—åˆ†è©³æƒ…æ¸…å–® */
        .history-section { margin-top: 30px; text-align: left; }
        .history-list { list-style: none; padding: 0; font-size: 0.85rem; max-height: 300px; overflow-y: auto; background: #2f3136; border-radius: 10px; }
        .history-item { padding: 8px 12px; border-bottom: 1px solid #3e4147; display: flex; justify-content: space-between; }
        .history-item span { color: var(--accent); }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ† ç¬¬2å±†çª®å˜¶ç›ƒ ğŸ†<br>æ­Œç‹æ­Œåçˆ­éœ¸æˆ°</h1>

    <div class="rules">
        <strong>â­ çµ¦åˆ†æ¨™æº–ï¼š</strong>
        <div>6â˜… è¶…å®Œç¾ ğŸ† / 5â˜… å¾ˆå²å®³ ğŸŒŸ / 4â˜… é‚„ä¸éŒ¯ ğŸ‘</div>
        <div>3â˜… æ™®æ™®é€šé€š ğŸ¤ / 2â˜… æ²’ç·´å¥½ï¼ŸğŸ˜ / 1â˜… è®“ä½ å€‘ ğŸ˜</div>
    </div>

    <p style="font-size: 0.95rem;">é€²åº¦ï¼šç¬¬ <span id="globalCount" style="color:var(--accent); font-weight:bold;">0</span> / 25 é¦–</p>

    <div class="player-selector" id="btnGroup"></div>

    <div class="score-card">
        <div id="statusTitle" style="font-weight: bold;">ğŸ¤ è«‹å…ˆé»é¸æ¼”å”±è€…</div>
        <div class="stars" id="starGroup">
            <span class="star" data-value="1">â˜…</span>
            <span class="star" data-value="2">â˜…</span>
            <span class="star" data-value="3">â˜…</span>
            <span class="star" data-value="4">â˜…</span>
            <span class="star" data-value="5">â˜…</span>
            <span class="star" data-value="6">â˜…</span>
        </div>
        <button class="submit-btn" onclick="submitData()">ç¢ºèªé€å‡ºåˆ†æ•¸</button>
    </div>

    <h3 style="margin-top:30px; color: var(--accent);">ğŸ“Š ç›®å‰ç¸½åˆ†æ’å</h3>
    <table>
        <thead><tr><th>æ’å</th><th>é¸æ‰‹</th><th>ç¸½åˆ†</th><th>é€²åº¦</th></tr></thead>
        <tbody id="statBody"></tbody>
    </table>

    <div class="history-section">
        <h3 style="color: var(--accent); text-align:center;">ğŸ“ æ¼”å”±è©³æƒ…å›é¡§</h3>
        <div class="history-list" id="historyList">
            <div style="padding:15px; text-align:center; color:#747d8c;">å°šæœªæœ‰è©•åˆ†ç´€éŒ„</div>
        </div>
    </div>

    <button onclick="resetAll()" style="margin: 40px 0; background:none; border:none; color:#747d8c; text-decoration:underline; font-size:0.8rem; cursor:pointer; width:100%;">æ¸…é™¤æ‰€æœ‰è³‡æ–™é‡ä¾†</button>
</div>

<script>
    const players = ["æ›‰ç¿”", "èˆ«å¦‚", "çŸ¥èª¼", "é˜¿å“²", "æŸ¥æŸ¥"];
    let gameData = JSON.parse(localStorage.getItem('poorSingCup_v3')) || {
        total: 0,
        players: players.map(name => ({ name, totalScore: 0, count: 0 })),
        history: [] // è¨˜éŒ„æ¯ä¸€é¦–çš„è©³ç´°å¾—åˆ†
    };

    let selectedPlayerIdx = -1;
    let currentScore = 0;

    function init() {
        renderPlayerBtns();
        updateStats();
        updateHistory();
        setupStarEvents();
    }

    function renderPlayerBtns() {
        const group = document.getElementById('btnGroup');
        group.innerHTML = gameData.players.map((p, i) => `
            <button class="player-btn ${selectedPlayerIdx === i ? 'active' : ''}" 
                    onclick="selectPlayer(${i})" 
                    ${p.count >= 5 ? 'disabled' : ''}>
                ${p.name}
                <span class="count-badge">${p.count}/5 é¦–</span>
            </button>
        `).join('');
    }

    window.selectPlayer = function(idx) {
        selectedPlayerIdx = idx;
        document.getElementById('statusTitle').innerHTML = `æ­£åœ¨è©•åˆ†ï¼š<span style="color:var(--accent)">${gameData.players[idx].name}</span>`;
        renderPlayerBtns();
    };

    function setupStarEvents() {
        const stars = document.querySelectorAll('.star');
        stars.forEach(s => {
            s.addEventListener('click', function() {
                if (selectedPlayerIdx === -1) return alert("è«‹å…ˆé»é¸ä¸Šé¢çš„æ¼”å”±è€…ï¼");
                currentScore = parseInt(this.getAttribute('data-value'));
                stars.forEach(star => {
                    star.classList.toggle('selected', parseInt(star.getAttribute('data-value')) <= currentScore);
                });
            });
        });
    }

    window.submitData = function() {
        if (selectedPlayerIdx === -1) return alert("è«‹é¸æ¼”å”±è€…");
        if (currentScore === 0) return alert("è«‹çµ¦æ˜Ÿæ˜Ÿ");

        const playerName = gameData.players[selectedPlayerIdx].name;
        
        // æ›´æ–°æ•¸æ“š
        gameData.players[selectedPlayerIdx].totalScore += currentScore;
        gameData.players[selectedPlayerIdx].count += 1;
        gameData.total += 1;
        
        // å­˜å…¥è©³æƒ…æ­·å²
        gameData.history.push({
            songNo: gameData.total,
            name: playerName,
            score: currentScore
        });

        localStorage.setItem('poorSingCup_v3', JSON.stringify(gameData));

        // é‡ç½®é¸å–
        selectedPlayerIdx = -1;
        currentScore = 0;
        document.getElementById('statusTitle').innerText = "ğŸ¤ è«‹é»é¸ä¸‹ä¸€ä½æ¼”å”±è€…";
        document.querySelectorAll('.star').forEach(s => s.classList.remove('selected'));
        
        renderPlayerBtns();
        updateStats();
        updateHistory();

        if (gameData.total === 25) alert("ğŸ‰ 25 é¦–æ­Œå…¨éƒ¨è©•åˆ†å®Œæˆï¼");
    };

    function updateStats() {
        document.getElementById('globalCount').innerText = gameData.total;
        const sorted = [...gameData.players].sort((a, b) => b.totalScore - a.totalScore);
        document.getElementById('statBody').innerHTML = sorted.map((p, i) => `
            <tr class="${i === 0 && p.totalScore > 0 ? 'rank-1' : ''}">
                <td>${i + 1}</td>
                <td>${p.name}</td>
                <td>${p.totalScore}</td>
                <td>${p.count}/5</td>
            </tr>
        `).join('');
    }

    function updateHistory() {
        const historyList = document.getElementById('historyList');
        if (gameData.history.length === 0) return;
        
        // ä¾ç…§æœ€æ–°é †åºæ’åˆ—ï¼ˆæœ€æ–°çš„åœ¨ä¸Šé¢ï¼‰
        const reversedHistory = [...gameData.history].reverse();
        
        historyList.innerHTML = reversedHistory.map(item => `
            <div class="history-item">
                <span>ç¬¬ ${item.songNo} é¦–</span>
                <strong>${item.name}</strong>
                <span>${item.score} é¡†æ˜Ÿ</span>
            </div>
        `).join('');
    }

    window.resetAll = function() {
        if (confirm("ç¢ºå®šè¦é‡ç½®å—ï¼Ÿé€™æœƒæ¸…é™¤æ‰€æœ‰å¾—åˆ†è©³æƒ…ï¼")) {
            localStorage.removeItem('poorSingCup_v3');
            location.reload();
        }
    };

    init();
</script>

</body>
</html>